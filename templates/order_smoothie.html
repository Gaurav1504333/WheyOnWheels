<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Place Order</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='order.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      overflow-x: hidden;
    }
    .smoothie-group {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      align-items: flex-start;
      margin-bottom: 15px;
      position: relative;
    }
    .smoothie-group label {
      flex: 1 1 100%;
      margin-bottom: 5px;
    }
    .smoothie-group select,
    .smoothie-group input[type="number"] {
      flex: 1;
      min-width: 0;
      position: relative;
      z-index: 1;
    }
    .remove-btn {
      background: #ffffffff;
      color: white;
      border: none;
      margin-top:4px;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .order{
      color: #000000;
    }
    /* âœ… Force dropdowns to always open downward */
.smoothie-group select {
  position: relative !important;
  transform: translateZ(0) !important;
  z-index: 10 !important;
}

.smoothie-group {
  overflow: visible !important; /* ensures dropdown isn't clipped */
}


    /* âœ… Force dropdown to open downward */
    select {
      position: relative;
      transform: translateZ(0);
    }
    select::-ms-expand {
      display: none; /* hide default arrow IE/Edge */
    }

    #confettiCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 9999;
    }
    .addon-wrapper {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 8px;
    }

    .addon-wrapper select {
      flex: 1;
    }

    .add-addon-btn {
      background: #ff4da6;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    label,input,small{
      font-family: 'Adieu', sans-serif;
    }
    .div{
      margin-bottom:100px !important;
    }
   @media (max-width: 480px){
  .choose{
    font-size: 12px !important;
  }

  input{
    font-size: 8px !important;
  }

  small{
    font-size: 8px !important;
    margin-top: -4px !important;
    display: block;
  }

  /* Redeem row alignment fix */
  .redeem-label {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .redeem-checkbox {
    transform: scale(0.7);
    cursor: pointer;
    margin: 0 !important;
  }

  .redeem-text{
    font-size: 10px;
    line-height: 1;
    margin: 0 !important;
    display: inline-block;
  }

  .add-addon-btn{
    margin-top: -8px !important;
  }
   select.smoothie {
    font-size: 12px !important;
    line-height: 1.2 !important;
    height: 32px !important;
    padding: 8px !important;
  }

  select.smoothie option {
    font-size: 12px !important;
  }
}



    
  </style>
</head>
<body>

<nav class="navbar">
  <!-- Mobile top bar: hamburger + logo + title -->
<div class="mobile-header">
  <button id="hamburger" class="hamburger" aria-label="Toggle menu" aria-expanded="false">â˜°</button>
  <span class="mobile-title">WHEY-ON-WHEELS</span>

  {% if session.get('user') %}
    <a href="/profile" class="mobile-profile">ðŸ‘¤</a>
  {% endif %}
</div>

  <!-- Desktop container (kept for desktop) -->
  <div class="navbar-container desktop-nav">
    <div class="nav-left">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/menu_select">Menu</a></li>
        <li><a href="/order_select">Order</a></li>
      </ul>
    </div>

    <div class="nav-right">
      <ul>
        <li><a href="#" id="scroll-about">About Us</a></li>
        <li><a href="#" id="contact-link">Contact Us</a></li>
        {% if session.get('user') %}
          <li><a href="/profile">ðŸ‘¤</a></li>
          <li><a href="/logout">Logout</a></li>
        {% else %}
          <li><a href="/login">Login</a></li>
        {% endif %}
      </ul>
    </div>
  </div>

  <!-- Mobile dropdown -->
  <div id="mobile-menu" class="mobile-menu" aria-hidden="true">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/menu_select">Menu</a></li>
      <li><a href="/order_select">Order</a></li>
      <li><a href="#" id="mobile-about">About Us</a></li>
      <li><a href="#" id="mobile-contact">Contact Us</a></li>
      {% if session.get('user') %}
        <li><a href="/profile">ðŸ‘¤ Profile</a></li>
        <li><a href="/logout">Logout</a></li>
      {% else %}
        <li><a href="/login">Login</a></li>
      {% endif %}
    </ul>
  </div>
</nav>

<div class="form-container">
  <h2>Place Your Order</h2>
  <form method="POST" action="/order_smoothie" id="orderForm">
    
    <div id="smoothieContainer">
      <div class="smoothie-group">
        <label class="choose">Choose a Smoothie and Quantity:</label>
        <select name="smoothie[]" class="smoothie">
  <option value="">None</option>
  {% for item in smoothies %}
    <option value="{{ item }}"
      {% if selected_smoothie == item %} selected {% endif %}>
      {{ item }}
    </option>
  {% endfor %}
</select>

        <input type="number" name="quantity[]" min="1" value="1">

        <div class="addon-wrapper">
  <select name="addon[][]" class="addon">
  <option value="">No Addon</option>
  {% for item in addons %}
    <option value="{{ item }}">{{ item }}</option>
  {% endfor %}
</select>

<button type="button" class="remove-btn" onclick="removeSmoothie(this)" style="display:none;">âž–</button>


  <!-- âž• button -->
  <button type="button" class="add-addon-btn" onclick="addAddon(this)">âž•</button>
</div>

      </div>
    </div>

    <div class="add-button" onclick="addSmoothie(); calculateTotal();">âž• Add Another Smoothie</div>

    <label class="redeem-label">
      <input type="checkbox" name="useRewards" id="redeem_toggle" class="redeem-checkbox">
      <span class="redeem-text">Redeem all reward points</span>
    </label>
    
    <input type="hidden" name="redeem_points" id="redeem_points" value="0" data-max="{{ user_rewards }}">
    <small>You have {{ user_rewards }} reward points</small>

    <div style="margin: 20px 0; font-weight: bold; font-size: 1em; font-family: 'Adieu', sans-serif;">
      Total Bill: â‚¹<span id="totalPrice">0</span>
    </div>
    <div id="discountNote" style="display:none; color: green; margin-top: -10px;">
      ðŸŽ‰ 10% multi-smoothie discount applied (2 or more smoothies)
    </div>

    <button type="submit" class="order">Place Order</button>
  </form>
</div>
<div class="div"></div>

<!-- Confetti JS -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
/* ======================================================
   SCROLL ANIMATIONS
====================================================== */
document.addEventListener("DOMContentLoaded", function () {
  const elements = document.querySelectorAll(".about-startup, .features");
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      entry.target.classList.toggle("animate-in", entry.isIntersecting);
    });
  }, { threshold: 0.3 });
  elements.forEach(el => observer.observe(el));
});


/* ======================================================
   HELPERS
====================================================== */
function normalize(str) {
  return str.trim().toLowerCase();
}

function scrollToAbout() {
  const about = document.querySelector(".about-startup");
  if (!about) return;

  const offset = -200; // âœ… mobile-safe offset
  const y = about.getBoundingClientRect().top + window.pageYOffset + offset;
  window.scrollTo({ top: y, behavior: "smooth" });
}

function contactUs() {
  window.location.href = "mailto:wheyonwheels@gmail.com";
}

function closeMobileMenu() {
  const hamburger = document.getElementById("hamburger");
  const mobileMenu = document.getElementById("mobile-menu");
  if (!hamburger || !mobileMenu) return;

  mobileMenu.classList.remove("open");
  hamburger.classList.remove("active");
  hamburger.setAttribute("aria-expanded", "false");
  mobileMenu.setAttribute("aria-hidden", "true");
}


/* ======================================================
   ABOUT + CONTACT (DESKTOP + MOBILE FIXED)
====================================================== */
document.addEventListener("DOMContentLoaded", () => {
  const desktopAbout = document.getElementById("scroll-about");
  const mobileAbout = document.getElementById("mobile-about");
  const desktopContact = document.getElementById("contact-link");
  const mobileContact = document.getElementById("mobile-contact");

  if (desktopAbout) desktopAbout.addEventListener("click", e => {
    e.preventDefault();
    scrollToAbout();
  });

  if (mobileAbout) mobileAbout.addEventListener("click", e => {
    e.preventDefault();
    scrollToAbout();
    closeMobileMenu();
  });

  if (desktopContact) desktopContact.addEventListener("click", e => {
    e.preventDefault();
    contactUs();
  });

  if (mobileContact) mobileContact.addEventListener("click", e => {
    e.preventDefault();
    contactUs();
    closeMobileMenu();
  });
});


/* ======================================================
   AUTO-SCROLL TO FORM (URL PARAM)
====================================================== */
document.addEventListener("DOMContentLoaded", () => {
  const url = new URL(window.location.href);
  if (url.searchParams.get("smoothie")) {
    document.querySelector(".form-container")
      ?.scrollIntoView({ behavior: "smooth" });
  }
});


/* ======================================================
   DATA FROM BACKEND
====================================================== */
const prices = {{ prices | tojson }};
const smoothies = {{ smoothies | tojson }};
const addons = {{ addons | tojson }};
let discountTriggered = false;


/* ======================================================
   CONFETTI
====================================================== */
function launchConfetti() {
  const end = Date.now() + 3000;
  (function frame() {
    confetti({ particleCount: 6, angle: 60, spread: 55, origin: { x: 0 } });
    confetti({ particleCount: 6, angle: 120, spread: 55, origin: { x: 1 } });
    if (Date.now() < end) requestAnimationFrame(frame);
  })();
}


/* ======================================================
   ADDON STATE
====================================================== */
function updateAddonState(group) {
  const smoothieSel = group.querySelector("select.smoothie");
  const addonSelects = group.querySelectorAll("select.addon");
  if (!smoothieSel) return;

  addonSelects.forEach(addonSel => {
    addonSel.disabled = !smoothieSel.value;
    addonSel.style.opacity = smoothieSel.value ? "1" : "0.5";
    if (!smoothieSel.value) addonSel.value = "";
  });
}


/* ======================================================
   TOTAL CALCULATION (UNCHANGED LOGIC)
====================================================== */
function calculateTotal() {
  let total = 0;
  let smoothieCount = 0;

  document.querySelectorAll(".smoothie-group").forEach(group => {
    const smoothie = group.querySelector("select.smoothie").value;
    const quantity = parseInt(group.querySelector("input").value) || 1;
    const smoothieKey = Object.keys(prices)
      .find(k => normalize(k) === normalize(smoothie));

    if (!smoothie || !smoothieKey) return;

    total += prices[smoothieKey] * quantity;
    smoothieCount += quantity;

    group.querySelectorAll("select.addon").forEach(addonSel => {
      const addonKey = Object.keys(prices)
        .find(k => normalize(k) === normalize(addonSel.value));
      if (addonKey) total += prices[addonKey];
    });
  });

  const discountNote = document.getElementById("discountNote");
  if (smoothieCount >= 2) {
    total *= 0.9;
    discountNote && (discountNote.style.display = "block");
    if (!discountTriggered) {
      launchConfetti();
      discountTriggered = true;
    }
  } else {
    discountNote && (discountNote.style.display = "none");
    discountTriggered = false;
  }

  const redeemToggle = document.getElementById("redeem_toggle");
  const redeemInput = document.getElementById("redeem_points");

  if (redeemToggle?.checked && redeemInput) {
    total -= parseInt(redeemInput.dataset.max || 0);
  }

  document.getElementById("totalPrice").textContent =
    Math.max(total, 0).toFixed(2);
}


/* ======================================================
   ADD / REMOVE SMOOTHIES
====================================================== */
function addAddon(button) {
  const wrapper = button.parentElement;
  const group = wrapper.parentElement;
  const clone = wrapper.cloneNode(true);
  clone.querySelector("select").value = "";
  group.appendChild(clone);
  updateAddonState(group);
  calculateTotal();
}

function addSmoothie() {
  const container = document.getElementById("smoothieContainer");
  const newGroup = document.createElement("div");
  newGroup.className = "smoothie-group";

  newGroup.innerHTML = `
    <select class="smoothie"><option value="">None</option>
      ${smoothies.map(s => `<option>${s}</option>`).join("")}
    </select>
    <input type="number" min="1" value="1">
    <div class="addon-wrapper">
      <select class="addon"><option value="">No Addon</option>
        ${addons.map(a => `<option>${a}</option>`).join("")}
      </select>
      <button type="button" onclick="addAddon(this)">âž•</button>
      <button type="button" onclick="removeSmoothie(this)">âž–</button>
    </div>`;

  container.appendChild(newGroup);
  updateAddonState(newGroup);
  newGroup.querySelectorAll("select,input")
    .forEach(el => el.addEventListener("change", calculateTotal));
  calculateTotal();
}

function removeSmoothie(btn) {
  btn.closest(".smoothie-group").remove();
  calculateTotal();
}


/* ======================================================
   MOBILE MENU
====================================================== */
document.addEventListener("DOMContentLoaded", () => {
  const hamburger = document.getElementById("hamburger");
  const mobileMenu = document.getElementById("mobile-menu");
  if (!hamburger || !mobileMenu) return;

  hamburger.addEventListener("click", () => {
    const open = mobileMenu.classList.toggle("open");
    hamburger.classList.toggle("active", open);
    hamburger.setAttribute("aria-expanded", open);
    mobileMenu.setAttribute("aria-hidden", !open);
  });

  mobileMenu.querySelectorAll("a").forEach(a =>
    a.addEventListener("click", closeMobileMenu)
  );

  document.addEventListener("keydown", e => {
    if (e.key === "Escape") closeMobileMenu();
  });
});
</script>




  <!-- Footer Section -->
  <footer class="site-footer">
  <div class="footer-container">

    <div class="footer-section about">
      <h3>WheyOnWheels</h3>
      <p>Your everyday healthy smoothie partner â€” fresh, nutritious, and delivered with care.</p>
    </div>

    <div class="footer-section contact">
      <h4>Contact Us</h4>
      <p>Email: <a href="mailto:wheyonwheelsmumbai@gmail.com">wheyonwheelsmumbai@gmail.com</a></p>
      <p>Location: Mumbai, India</p>
    </div>

    <div class="footer-section social">
      <h4>Follow Us</h4>
      <div class="social-links">
        <a href="https://instagram.com/whey_on_wheels" target="_blank">Instagram</a>
      </div>
    </div>

  </div>

  <p class="footer-bottom">&copy; 2025 WheyOnWheels â€¢ All Rights Reserved</p>
</footer>


</body>
</html>






























