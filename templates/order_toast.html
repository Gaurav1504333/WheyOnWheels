<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Place Order</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='order.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body { overflow-x: hidden; }

    .toast-group {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .toast-group label {
      flex: 1 1 100%;
      margin-bottom: 5px;
    }

    .toast-group select,
    .toast-group input[type="number"] {
      flex: 1;
      min-width: 0;
    }

    #discountNote {
      display: none;
      color: green;
      margin-top: -10px;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .remove-btn {
      background: #ffffff;
      color: black;
      border: none;
      margin-top: 4px;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    label, input, small {
      font-family: 'Adieu', sans-serif;
    }

    .redeem-label {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
    }

    .redeem-checkbox {
      transform: scale(1);
      cursor: pointer;
    }

    .redeem-text {
      font-size: 14px;
    }

    @media (max-width: 480px) {
      .choose {
        font-size: 12px !important;
      }

      input {
        font-size: 9px !important;
      }

      small {
        font-size: 8px !important;
        display: block;
        margin-top: -4px !important;
      }

      .redeem-label {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .redeem-checkbox {
        transform: scale(0.7);
        margin: 0 !important;
      }

      .redeem-text {
        font-size: 10px;
        line-height: 1;
      }
      .div{
        margin-bottom:100px;
      }
      .toast{
        font-size: 9px;
      }
    }
  </style>
</head>

<body>

<nav class="navbar">
  <div class="mobile-header">
    <button id="hamburger" class="hamburger" aria-label="Toggle menu" aria-expanded="false">â˜°</button>
    <span class="mobile-title">WHEY-ON-WHEELS</span>

    {% if session.get('user') %}
      <a href="/profile" class="mobile-profile">ðŸ‘¤</a>
    {% endif %}
  </div>

  <div class="navbar-container desktop-nav">
    <div class="nav-left">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/menu_select">Menu</a></li>
        <li><a href="/order_select">Order</a></li>
      </ul>
    </div>

    <div class="nav-right">
      <ul>
        <li><a href="#" id="scroll-about">About Us</a></li>
        <li><a href="#" id="contact-link">Contact Us</a></li>
        {% if session.get('user') %}
          <li><a href="/profile">ðŸ‘¤</a></li>
          <li><a href="/logout">Logout</a></li>
        {% else %}
          <li><a href="/login">Login</a></li>
        {% endif %}
      </ul>
    </div>
  </div>

  <div id="mobile-menu" class="mobile-menu" aria-hidden="true">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/menu_select">Menu</a></li>
      <li><a href="/order_select">Order</a></li>
      <li><a href="#" id="mobile-about">About Us</a></li>
      <li><a href="#" id="mobile-contact">Contact Us</a></li>
      {% if session.get('user') %}
        <li><a href="/profile">ðŸ‘¤ Profile</a></li>
        <li><a href="/logout">Logout</a></li>
      {% else %}
        <li><a href="/login">Login</a></li>
      {% endif %}
    </ul>
  </div>
</nav>

<div class="form-container">
  <h2>Place Your Order</h2>

  <form method="POST" action="/order_toast" id="orderForm">

    <div id="toastContainer">
      <div class="toast-group">
        <label class="choose">Choose a Toast and Quantity:</label>

        <select name="toast[]" class="toast">
          <option value="">None</option>
          {% for item in toasts %}
            <option value="{{ item }}">{{ item }}</option>
          {% endfor %}
        </select>

        <input type="number" name="quantity[]" min="1" value="1">
      </div>
    </div>

    <div class="add-button" onclick="addToast(); calculateTotal();">
      âž• Add Another Order
    </div>

    <label class="redeem-label">
      <input type="checkbox" name="useRewards" id="redeem_toggle" class="redeem-checkbox">
      <span class="redeem-text">Redeem all reward points</span>
    </label>

    <input type="hidden" name="redeem_points" id="redeem_points" value="0" data-max="{{ user_rewards }}">
    <small>You have {{ user_rewards }} reward points</small>

    <div style="margin: 20px 0; font-weight: bold; font-size: 1em; font-family: 'Adieu', sans-serif;">
      Total Bill: â‚¹<span id="totalPrice">0</span>
    </div>

    <div id="discountNote">ðŸŽ‰ 10% discount applied (2 or more toasts)</div>

    <button type="submit" style="color:#000000;">Place Order</button>
  </form>
</div>
<div class="div"></div>  
<!-- Confetti JS -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
const prices = {{ prices | tojson }};
const toasts = {{ toasts | tojson }};
let discountTriggered = false;

function normalize(str) {
  return str.trim().toLowerCase();
}

function launchConfetti() {
  const duration = 2000;
  const end = Date.now() + duration;

  (function frame() {
    confetti({ particleCount: 4, angle: 60, spread: 55, origin: { x: 0 } });
    confetti({ particleCount: 4, angle: 120, spread: 55, origin: { x: 1 } });
    if (Date.now() < end) requestAnimationFrame(frame);
  })();
}

function calculateTotal() {
  let total = 0;
  let totalItems = 0;

  document.querySelectorAll(".toast-group").forEach(group => {
    const toastSelect = group.querySelector("select.toast");
    const qtyInput = group.querySelector("input[name='quantity[]']");
    const toast = toastSelect.value;
    const qty = parseInt(qtyInput.value) || 1;

    const key = Object.keys(prices).find(k => normalize(k) === normalize(toast));
    if (toast && key) {
      total += parseFloat(prices[key]) * qty;
      totalItems += qty;
    }
  });

  const discountNote = document.getElementById("discountNote");

  if (totalItems >= 2) {
    total *= 0.9;
    discountNote.style.display = "block";

    if (!discountTriggered) {
      launchConfetti();
      discountTriggered = true;
    }
  } else {
    discountNote.style.display = "none";
    discountTriggered = false;
  }

  const toggle = document.getElementById("redeem_toggle");
  const hidden = document.getElementById("redeem_points");

  if (toggle.checked) {
    const maxRedeem = parseInt(hidden.dataset.max) || 0;
    hidden.value = maxRedeem;
    total -= maxRedeem;
  } else {
    hidden.value = 0;
  }

  if (total < 0) total = 0;
  document.getElementById("totalPrice").textContent = total.toFixed(2);
}

function addToast() {
  const container = document.getElementById("toastContainer");
  const newGroup = document.createElement("div");
  newGroup.className = "toast-group";

  const toastOptions = toasts
    .map(item => `<option value="${item}">${item}</option>`)
    .join("");

  newGroup.innerHTML = `
    <label>Choose a Toast and Quantity:</label>

    <select name="toast[]" class="toast">
      <option value="">None</option>
      ${toastOptions}
    </select>

    <input type="number" name="quantity[]" min="1" value="1">

    <button type="button" class="remove-btn" onclick="removeToast(this)">âž–</button>
  `;

  container.appendChild(newGroup);

  newGroup.querySelectorAll("select, input").forEach(el => {
    el.addEventListener("change", calculateTotal);
    el.addEventListener("input", calculateTotal);
  });

  calculateTotal();
}

function removeToast(button) {
  const group = button.closest(".toast-group");
  if (group) {
    group.remove();
    calculateTotal();
  }
}

document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll("select, input").forEach(el => {
    el.addEventListener("change", calculateTotal);
    el.addEventListener("input", calculateTotal);
  });

  document.getElementById("redeem_toggle").addEventListener("change", calculateTotal);
  calculateTotal();
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const hamburger = document.getElementById("hamburger");
  const mobileMenu = document.getElementById("mobile-menu");

  if (!hamburger || !mobileMenu) return;

  hamburger.addEventListener("click", function () {
    const open = mobileMenu.classList.toggle("open");
    hamburger.classList.toggle("active", open);
    mobileMenu.setAttribute("aria-hidden", !open);
    hamburger.setAttribute("aria-expanded", open);
  });

  mobileMenu.querySelectorAll("a").forEach(a => {
    a.addEventListener("click", () => {
      mobileMenu.classList.remove("open");
      hamburger.classList.remove("active");
      mobileMenu.setAttribute("aria-hidden", "true");
      hamburger.setAttribute("aria-expanded", "false");
    });
  });

  document.addEventListener("keydown", e => {
    if (e.key === "Escape") {
      mobileMenu.classList.remove("open");
      hamburger.classList.remove("active");
      mobileMenu.setAttribute("aria-hidden", "true");
      hamburger.setAttribute("aria-expanded", "false");
    }
  });
});
</script>

<footer class="site-footer">
  <div class="footer-container">
    <div class="footer-section about">
      <h3>WheyOnWheels</h3>
      <p>Your everyday healthy smoothie partner â€” fresh, nutritious, and delivered with care.</p>
    </div>

    <div class="footer-section contact">
      <h4>Contact Us</h4>
      <p>Email: <a href="mailto:wheyonwheelsmumbai@gmail.com">wheyonwheelsmumbai@gmail.com</a></p>
      <p>Location: Mumbai, India</p>
    </div>

    <div class="footer-section social">
      <h4>Follow Us</h4>
      <div class="social-links">
        <a href="https://instagram.com/whey_on_wheels" target="_blank">Instagram</a>
      </div>
    </div>
  </div>

  <p class="footer-bottom">&copy; 2025 WheyOnWheels â€¢ All Rights Reserved</p>
</footer>

</body>
</html>


